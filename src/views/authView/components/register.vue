<template>
    <div class="card text-center" style="width: 700px; margin: 20px auto;">
        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs">
                <li class="nav-item" v-for="(item, index) in roles">
                    <span class="nav-link" :class="{ active: curIndex == index }" :aria-current="curIndex == index"
                        @click="chooseRole(index)">{{ item.name }}</span>
                </li>
            </ul>
        </div>
        <div class="card-body">
            <!-- Â≠¶Áîü -->
            <div class="studentBody" v-show="curIndex == 0">
                <!-- Ë¥¶Âè∑ -->
                <div class="row mb-3 align-items-center">
                    <div class="col-sm-12">
                        <div class="input-group">
                            <span class="input-group-text">@</span>
                            <input type="text" v-model="accountForm.username" class="form-control" id="account"
                                placeholder="ËØ∑ËæìÂÖ•Ë¥¶Âè∑">
                        </div>
                    </div>
                </div>

                <!-- ÂØÜÁ†Å Âíå ÈáçÂ§çÂØÜÁ†Å ÊîæÂú®‰∏ÄË°å -->
                <div class="row mb-3 align-items-center">
                    <!-- ÂØÜÁ†Å -->
                    <div class="col-sm-6">
                        <div class="input-group">
                            <span class="input-group-text">üîí</span>
                            <input type="password" v-model="accountForm.password" class="form-control"
                                placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å">
                        </div>
                    </div>
                    <!-- ÈáçÂ§çÂØÜÁ†Å -->
                    <div class="col-sm-6">
                        <div class="input-group">
                            <span class="input-group-text">üîí</span>
                            <input type="password" class="form-control" v-model="accountForm.rePassword"
                                placeholder="ËØ∑Á°ÆËÆ§ÂØÜÁ†Å">
                        </div>
                    </div>
                </div>

                <!-- ÂßìÂêç Âíå ÊÄßÂà´ ÊîæÂú®‰∏ÄË°å -->
                <div class="row mb-3 align-items-center">
                    <!-- ÂßìÂêç -->
                    <div class="col-sm-4">
                        <div class="input-group">
                            <span class="input-group-text">üßë‚Äçüéì</span>
                            <input type="text" class="form-control" v-model="studentForm.name" id="studentName"
                                placeholder="ËØ∑ËæìÂÖ•ÂßìÂêç">
                        </div>
                    </div>
                    <!-- ÊÄßÂà´ -->
                    <div class="col-sm-4">
                        <div class="input-group">
                            <span class="input-group-text">‚ôÇ|‚ôÄ</span>
                            <select class="form-select" id="gender" v-model="studentForm.gender">
                                <option value="">ÈÄâÊã©ÊÄßÂà´</option>
                                <option value="Áî∑">Áî∑</option>
                                <option value="Â•≥">Â•≥</option>
                                <option value="‰øùÂØÜ">‰øùÂØÜ</option>
                            </select>
                        </div>
                    </div>
                    <!-- Âπ¥Á∫ß -->
                    <div class="col-sm-4">
                        <div class="input-group">
                            <span class="input-group-text">üéì</span>
                            <select class="form-select" id="grade" v-model="studentForm.grade">
                                <option value="">ÈÄâÊã©Âπ¥Á∫ß</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Â≠¶Âè∑ Âíå ‰∏ì‰∏ö ÊîæÂú®‰∏ÄË°å -->
                <div class="row mb-3 align-items-center">
                    <!-- Â≠¶Âè∑ -->
                    <div class="col-sm-6">
                        <div class="input-group">
                            <span class="input-group-text">#</span>
                            <input type="text" class="form-control" v-model="studentForm.student_id" id="studentId"
                                placeholder="ËØ∑ËæìÂÖ•Â≠¶Âè∑">
                        </div>
                    </div>

                    <!-- ‰∏ì‰∏ö -->
                    <div class="col-sm-6">
                        <div class="input-group">
                            <span class="input-group-text">üìò</span>
                            <input type="text" class="form-control" v-model="studentForm.major" id="major"
                                placeholder="ËØ∑ËæìÂÖ•‰∏ì‰∏ö">
                        </div>
                    </div>

                </div>



            </div>
            <!-- ËÄÅÂ∏à -->
            <div class="teacherBody" v-show="curIndex == 1">
                <!-- Ë¥¶Âè∑ -->
                <div class="row mb-3 align-items-center">
                    <div class="col-sm-12">
                        <div class="input-group">
                            <span class="input-group-text">@</span>
                            <input type="text" v-model="accountForm.username" class="form-control" id="teacherAccount" placeholder="ËØ∑ËæìÂÖ•Ë¥¶Âè∑">
                        </div>
                    </div>
                </div>
                <!-- ÂØÜÁ†Å Âíå ÈáçÂ§çÂØÜÁ†Å ÊîæÂú®‰∏ÄË°å -->
                <div class="row mb-3 align-items-center">
                    <!-- ÂØÜÁ†Å -->
                    <div class="col-sm-6">
                        <div class="input-group">
                            <span class="input-group-text">üîí</span>
                            <input type="password" v-model="accountForm.password" class="form-control" id="teacherPassword" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å">
                        </div>
                    </div>
                    <!-- ÈáçÂ§çÂØÜÁ†Å -->
                    <div class="col-sm-6">
                        <div class="input-group">
                            <span class="input-group-text">üîí</span>
                            <input type="password" v-model="accountForm.rePassword" class="form-control" id="confirmPassword" placeholder="ËØ∑Á°ÆËÆ§ÂØÜÁ†Å">
                        </div>
                    </div>
                </div>

                <!-- ÂßìÂêç Âíå ÊÄßÂà´ ÊîæÂú®‰∏ÄË°å -->
                <div class="row mb-3 align-items-center">
                    <!-- ÂßìÂêç -->
                    <div class="col-sm-6">
                        <div class="input-group">
                            <span class="input-group-text">üë®‚Äçüè´</span>
                            <input type="text" class="form-control" v-model="teacherForm.name" id="teacherName" placeholder="ËØ∑ËæìÂÖ•ÂßìÂêç">
                        </div>
                    </div>
                    <!-- ÊÄßÂà´ -->
                    <div class="col-sm-6">
                        <div class="input-group">
                            <span class="input-group-text">‚ôÇ/‚ôÄ</span>
                            <select class="form-select" id="teacherGender" v-model="teacherForm.gender">
                                <option value="">ËØ∑ÈÄâÊã©ÊÄßÂà´</option>
                                <option value="Áî∑">Áî∑</option>
                                <option value="Â•≥">Â•≥</option>
                                <option value="‰øùÂØÜ">‰øùÂØÜ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Â∑•Âè∑ Âíå Èô¢Á≥ª ÊîæÂú®‰∏ÄË°å -->
                <div class="row mb-3 align-items-center">
                    <!-- Â∑•Âè∑ -->
                    <div class="col-sm-6">
                        <div class="input-group">
                            <span class="input-group-text">#</span>
                            <input type="text" v-model="teacherForm.teacher_id" class="form-control" id="teacherId" placeholder="ËØ∑ËæìÂÖ•Â∑•Âè∑">
                        </div>
                    </div>
                    <!-- Èô¢Á≥ª -->
                    <div class="col-sm-6">
                        <div class="input-group">
                            <span class="input-group-text">üèõ</span>
                            <input type="text" class="form-control" v-model="teacherForm.department" id="department" placeholder="ËØ∑ËæìÂÖ•Èô¢Á≥ª">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12" style="text-align: left; padding: 12px;">
                <button class="btn btn-primary" type="submit" style="width: 80px;" @click="submit">Ê≥®ÂÜå</button>
                <button class="btn" style="width: 80px;" @click="toLogin">ÂéªÁôªÂΩï</button>

            </div>
        </div>
    </div>
</template>

<script setup>
const curIndex = ref(0)
const roles = ref([
    {
        name: "ÊàëÊòØÂ≠¶Áîü",
    },
    {
        name: "ÊàëÊòØÊïôÂ∏à",
    },
])

const chooseRole = (index) => {
    curIndex.value = index
}

const router = useRouter()
const toLogin = () => {
    router.push('/login')
}

const accountForm = ref({
    username: '',
    password: '',
    rePassword: '',
    role: '',
})
const studentForm = ref({
    name: '',
    gender: '',
    grade: '',
    student_id: '',
    major: ''

})

const teacherForm = ref({
    name: '',
    gender: '',
    gender: "",
    teacher_id: "",
    department: ""
})

const { proxy } = getCurrentInstance()
const registerStudent = () => {
    accountForm.value.role = 'student'
    let form = {
        ...accountForm.value,
        ...studentForm.value
    }
    proxy.$api.register(form, 'student').then(res => {
        if (res.code == 20000) {
            router.push('/login')
        }
    })

}

const registerTeacher = () => {
    accountForm.value.role = 'teacher'
    let form = {
        ...accountForm.value,
        ...teacherForm.value
    }
    proxy.$api.register(form, 'teacher').then(res => {
        if (res.code == 20000) {
            router.push('/login')
        }
    })
}
const submit = () => {
    if (curIndex.value == 0) {
        registerStudent()
    } else if (curIndex.value == 1) {
        registerTeacher()
    }
}

</script>

<style scoped>
.nav-link {
    cursor: pointer;
}

.row {
    margin: 5px 0;
}
</style>